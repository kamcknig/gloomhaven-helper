<p-card header="{{value?.name}}">
  <ng-container *ngIf="{ level: (appService.scenarioStore.level$ | async) ?? 0 } as level">
    <div fxLayout="row" fxLayoutAlign="space-between center" class="text-m">
      <!-- normal stats -->
      <div fxLayout="column" fxFlex>
        <span fxLayout="row" fxLayoutAlign="start center">
          <img class="icon" src="assets/icons/health.png">
          {{getStatDisplayValue(value?.health?.[level?.level ?? 0]?.[0])}}
        </span>

        <span fxLayout="row" fxLayoutAlign="start center">
          <img class="icon" src="assets/icons/move.png">
          {{getStatDisplayValue(value?.move?.[level?.level ?? 0]?.[0])}}
        </span>

        <span fxLayout="row" fxLayoutAlign="start center">
          <img class="icon" src="assets/icons/attack.png">
          {{getStatDisplayValue(value?.attack?.[level?.level ?? 0]?.[0])}}
        </span>

        <span fxLayout="row" fxLayoutAlign="start center">
          <img class="icon" src="assets/icons/range.png">
          {{getStatDisplayValue(value?.range?.[level?.level ?? 0]?.[0])}}
        </span>

      </div>

      <!-- elite stats -->
      <div fxLayout="column" fxFlex>
        <span fxLayout="row" fxLayoutAlign="end center">
          {{getStatDisplayValue(value?.health?.[level?.level ?? 0]?.[1])}}
          <img class="icon" src="assets/icons/health.png">
        </span>

        <span fxLayout="row" fxLayoutAlign="end center">
          {{getStatDisplayValue(value?.move?.[level?.level ?? 0]?.[1])}}
          <img class="icon" src="assets/icons/move.png">
        </span>

        <span fxLayout="row" fxLayoutAlign="end center">
          {{getStatDisplayValue(value?.attack?.[level?.level ?? 0]?.[1])}}
          <img class="icon"src="assets/icons/attack.png">
        </span>

        <span fxLayout="row" fxLayoutAlign="end center">
          {{getStatDisplayValue(value?.range?.[level?.level ?? 0]?.[1])}}
          <img class="icon" src="assets/icons/range.png">
        </span>
      </div>
    </div>

    <p-divider></p-divider>

    <div class="text-m">
      <div>Tokens</div>

      <div fxLayout="row" fxLayoutAlign="space-between">
        <p-scrollPanel [style]="{ height: '11rem' }" fxFlex>
          <p-dataView [value]="(tokens$ | async)?.normals ?? []" layout="list">
            <ng-template let-token pTemplate="listItem">
              <ng-container [ngTemplateOutlet]="listItemTemplate" [ngTemplateOutletContext]="{ '$implicit': token }"></ng-container>
            </ng-template>
          </p-dataView>
        </p-scrollPanel>

        <p-scrollPanel [style]="{ height: '11rem' }" fxFlex>
          <p-dataView [value]="(tokens$ | async)?.elites ?? []" layout="list">
            <ng-template let-token pTemplate="listItem">
              <ng-container [ngTemplateOutlet]="listItemTemplate" [ngTemplateOutletContext]="{ '$implicit': token }"></ng-container>
            </ng-template>
          </p-dataView>
        </p-scrollPanel>
      </div>
    </div>
  </ng-container>

  <ng-template pTemplate="footer">
    <button
      pButton
      type="button"
      (click)="addToken()"
      icon="pi pi-plus"
      class="p-button-rounded"></button>
  </ng-template>
</p-card>

<ng-template #listItemTemplate let-token>
  <div [id]="'list-item-' + (token.elite ? 'elite' : 'normal')" fxFlexFill fxLayout="row" fxLayoutAlign="space-between center" class="list-item">
    <div fxFlex>{{token.number}} - <span class="text-red-600">{{token.health ?? token.maxHealth}}</span></div>

    <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap=".5rem">
      <button
        (click)="tokenService.updateTokenHitPoint$.next([token, 1])"
        pButton
        pRipple
        type="button"
        icon="pi pi-plus"
        class="p-button-success p-button-rounded"></button>

      <button
        (click)="tokenService.updateTokenHitPoint$.next([token, -1])"
        pButton
        pRipple
        type="button"
        icon="pi pi-minus"
        class="p-button-danger p-button-rounded"></button>
    </div>
  </div>
</ng-template>
